<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Win95: BTM@37*(431) - Radio Market Adventure</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @font-face {
            font-family: 'Pixel';
            src: url('https://fonts.cdnfonts.com/css/pixel-operator') format('woff2');
        }

        body, html {
            margin: 0; padding: 0;
            overflow: hidden;
            background: #000;
            font-family: 'Tahoma', sans-serif;
        }

        /* --- –°–¢–ò–õ–ò –ú–ò–†–ê (Undertale Style) --- */
        #world-layer {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: #222;
        }

        #game-canvas {
            background: #333; /* –ü–æ–ª —Ä—ã–Ω–∫–∞ */
            image-rendering: pixelated;
            border: 4px solid #444;
            max-width: 100%;
            max-height: 100%;
        }

        .dialog-box {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            max-width: 600px;
            background: #000;
            border: 4px solid #fff;
            color: #fff;
            padding: 15px;
            font-family: 'Courier New', monospace;
            display: none;
            z-index: 50;
        }

        /* --- –°–¢–ò–õ–ò –û–° (Windows 95 Mode) --- */
        #os-layer {
            position: fixed;
            top: 0; left: 0;
            width: 100vw; height: 100vh;
            background: #008080; /* Teal */
            display: none;
            z-index: 100;
            flex-direction: column;
        }

        .win95-border {
            border: 2px solid;
            border-color: #ffffff #808080 #808080 #ffffff;
            background: #c0c0c0;
        }

        .win95-inset {
            border: 2px solid;
            border-color: #808080 #ffffff #ffffff #808080;
            background: #fff;
        }

        .title-bar {
            background: linear-gradient(90deg, #000080, #1084d0);
            color: white;
            padding: 2px 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: bold;
            font-size: 14px;
        }

        .taskbar {
            height: 38px;
            background: #c0c0c0;
            border-top: 2px solid #ffffff;
            display: flex;
            align-items: center;
            padding: 2px 5px;
            margin-top: auto;
        }

        .start-btn {
            font-weight: bold;
            border: 2px solid;
            border-color: #ffffff #808080 #808080 #ffffff;
            padding: 2px 8px;
            background: #c0c0c0;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* –≠—Ñ—Ñ–µ–∫—Ç —à—É–º–∞/–≠–õ–¢ */
        .crt::before {
            content: " ";
            display: block;
            position: absolute;
            top: 0; left: 0; bottom: 0; right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.03), rgba(0, 255, 0, 0.01), rgba(0, 0, 255, 0.03));
            z-index: 1000;
            background-size: 100% 3px, 3px 100%;
            pointer-events: none;
        }
    </style>
</head>
<body class="crt">

    <!-- –°–õ–û–ô 1: –ú–ò–† (–ë–†–û–î–ò–õ–ö–ê) -->
    <div id="world-layer">
        <canvas id="game-canvas"></canvas>
        
        <div id="world-hud" class="absolute top-4 left-4 text-white font-mono text-sm bg-black/50 p-2 border border-white">
            –§–∏–ª–∏–ø–ø | –ü–∞–≤–∏–ª—å–æ–Ω 42<br>
            –•–∞–æ—Å: <span id="chaos-val">0</span>%
        </div>

        <div id="interaction-prompt" class="absolute bottom-32 left-1/2 -translate-x-1/2 text-white bg-black p-2 border-2 border-white text-xs hidden animate-bounce">
            [–ü–†–û–ë–ï–õ] –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å
        </div>

        <div id="dialog-box" class="dialog-box">
            <div id="dialog-text">...</div>
            <div class="text-[10px] mt-2 text-gray-400">–ù–∞–∂–º–∏—Ç–µ [–ü–†–û–ë–ï–õ], —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å</div>
        </div>
    </div>

    <!-- –°–õ–û–ô 2: –û–ü–ï–†–ê–¶–ò–û–ù–ù–ê–Ø –°–ò–°–¢–ï–ú–ê (–ö–û–ú–ü–¨–Æ–¢–ï–†) -->
    <div id="os-layer">
        <div class="p-8 grid grid-cols-1 gap-8 w-24">
            <!-- Icons -->
            <div class="flex flex-col items-center gap-1 cursor-pointer" onclick="openVirusWin()">
                <div class="text-3xl">üìÅ</div>
                <span class="text-white text-xs text-center font-bold shadow-black">BTM_CORE</span>
            </div>
            <div class="flex flex-col items-center gap-1 cursor-pointer">
                <div class="text-3xl">üóëÔ∏è</div>
                <span class="text-white text-xs text-center font-bold shadow-black">–ö–æ—Ä–∑–∏–Ω–∞</span>
            </div>
        </div>

        <!-- Window: Virus Control -->
        <div id="virus-window" class="win95-border absolute top-20 left-40 w-80 shadow-xl hidden">
            <div class="title-bar">
                <span>BTM@37*(431) - Terminal</span>
                <button class="bg-[#c0c0c0] text-black px-2 text-xs border border-white" onclick="closeOS()">X</button>
            </div>
            <div class="p-4 flex flex-col gap-4">
                <div class="win95-inset bg-black text-[#0f0] p-2 font-mono text-xs h-32 overflow-y-auto" id="terminal-out">
                    > –í–ê–° –ü–†–ò–í–ï–¢–°–¢–í–£–ï–¢ BTM@37*(431)<br>
                    > –û–ë–ù–ê–†–£–ñ–ï–ù –ú–ê–ô–ù–ò–ù–ì–û–í–´–ô –ü–û–¢–ï–ù–¶–ò–ê–õ...
                </div>
                <div class="flex flex-col gap-2">
                    <button class="btn-win95" onclick="cmd('TURBO')">–ó–ê–ü–£–°–¢–ò–¢–¨ –¢–£–†–ë–û-–ú–ê–ô–ù–ò–ù–ì</button>
                    <button class="btn-win95" onclick="cmd('SCAN')">–°–ö–ê–ù–ò–†–û–í–ê–¢–¨ –†–ï–ê–õ–¨–ù–û–°–¢–¨</button>
                    <button class="btn-win95" onclick="closeOS()">–í–´–ô–¢–ò –í –†–ï–ê–õ–¨–ù–û–°–¢–¨</button>
                </div>
            </div>
        </div>

        <!-- Taskbar -->
        <div class="taskbar">
            <div class="start-btn">
                <span class="text-lg">ü™ü</span> –ü—É—Å–∫
            </div>
            <div class="win95-inset px-2 py-1 mx-2 text-xs font-bold bg-[#c0c0c0] flex-1">
                BTM@37*(431) System Monitor
            </div>
            <div class="win95-inset px-4 py-1 text-xs">
                15:43
            </div>
        </div>
    </div>

<script>
    const canvas = document.getElementById('game-canvas');
    const ctx = canvas.getContext('2d');
    const worldLayer = document.getElementById('world-layer');
    const osLayer = document.getElementById('os-layer');
    const dialogBox = document.getElementById('dialog-box');
    const prompt = document.getElementById('interaction-prompt');

    canvas.width = 640;
    canvas.height = 480;

    const state = {
        mode: 'world', // 'world', 'dialog', 'os'
        chaos: 0,
        player: { x: 300, y: 350, w: 32, h: 48, speed: 4 },
        keys: {},
        objects: [
            { id: 'pc', x: 280, y: 150, w: 80, h: 60, color: '#aaa', type: 'pc', name: '–°–∏—Å—Ç–µ–º–Ω–∏–∫ —à–∫–æ–ª—å–Ω–∏–∫–æ–≤', fleeSpeed: 5 },
            { id: 'table', x: 100, y: 200, w: 120, h: 40, color: '#543', type: 'static', name: '–°—Ç–æ–ª —Å —Ö–ª–∞–º–æ–º' },
            { id: 'npc_vasya', x: 500, y: 200, w: 32, h: 48, color: '#f0f', type: 'npc', name: '–î—è–¥—è –í–∞—Å—è' }
        ],
        nearObject: null
    };

    // --- –õ–û–ì–ò–ö–ê –ú–ò–†–ê ---

    function drawWorld() {
        if (state.mode === 'os') return;

        ctx.fillStyle = '#333';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // –°–µ—Ç–∫–∞ –ø–æ–ª–∞
        ctx.strokeStyle = '#444';
        for(let i=0; i<canvas.width; i+=40) {
            ctx.beginPath(); ctx.moveTo(i,0); ctx.lineTo(i, canvas.height); ctx.stroke();
        }
        for(let j=0; j<canvas.height; j+=40) {
            ctx.beginPath(); ctx.moveTo(0,j); ctx.lineTo(canvas.width, j); ctx.stroke();
        }

        // –û–±—ä–µ–∫—Ç—ã
        state.objects.forEach(obj => {
            let drawX = obj.x;
            let drawY = obj.y;

            // –î—è–¥—è –í–∞—Å—è –Ω–∞—á–∏–Ω–∞–µ—Ç —Ç—Ä—è—Å—Ç–∏—Å—å, –µ—Å–ª–∏ –•–∞–æ—Å > 0
            if (obj.id === 'npc_vasya' && state.chaos > 0) {
                const shakeIntensity = state.chaos / 10;
                drawX += (Math.random() - 0.5) * shakeIntensity;
                drawY += (Math.random() - 0.5) * shakeIntensity;
            }

            // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –æ–±—ä–µ–∫—Ç–∞
            const isEvilPC = (obj.id === 'pc' && state.chaos >= 100);
            ctx.fillStyle = isEvilPC ? '#800' : obj.color;
            ctx.fillRect(drawX, drawY, obj.w, obj.h);
            ctx.strokeStyle = '#000';
            ctx.strokeRect(drawX, drawY, obj.w, obj.h);

            // –ó–ª–æ–±–Ω–∞—è —Ä–æ–∂–∏—Ü–∞ –Ω–∞ —Å–∏—Å—Ç–µ–º–Ω–∏–∫–µ –ø—Ä–∏ 100% —Ö–∞–æ—Å–∞
            if (isEvilPC) {
                ctx.fillStyle = '#f00';
                // –ì–ª–∞–∑–∞
                ctx.fillRect(drawX + 15, drawY + 15, 10, 5);
                ctx.fillRect(drawX + obj.w - 25, drawY + 15, 10, 5);
                // –û—Å–∫–∞–ª
                ctx.strokeStyle = '#f00';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(drawX + 20, drawY + 40);
                ctx.lineTo(drawX + 30, drawY + 35);
                ctx.lineTo(drawX + 40, drawY + 40);
                ctx.lineTo(drawX + 50, drawY + 35);
                ctx.lineTo(drawX + 60, drawY + 40);
                ctx.stroke();
            }
            
            // –ù–∞–∑–≤–∞–Ω–∏—è
            ctx.fillStyle = '#fff';
            ctx.font = '10px monospace';
            ctx.fillText(obj.name, drawX, drawY - 5);
        });

        // –§–∏–ª–∏–ø–ø
        ctx.fillStyle = '#000080';
        ctx.fillRect(state.player.x, state.player.y, state.player.w, state.player.h);
        ctx.fillStyle = '#fff';
        ctx.fillRect(state.player.x + 6, state.player.y + 10, 6, 6);
        ctx.fillRect(state.player.x + 20, state.player.y + 10, 6, 6);
    }

    function updateWorld() {
        if (state.mode !== 'world') return;

        const p = state.player;
        let dx = 0, dy = 0;

        if (state.keys['ArrowUp'] || state.keys['w']) dy = -p.speed;
        if (state.keys['ArrowDown'] || state.keys['s']) dy = p.speed;
        if (state.keys['ArrowLeft'] || state.keys['a']) dx = -p.speed;
        if (state.keys['ArrowRight'] || state.keys['d']) dx = p.speed;

        const nextX = p.x + dx;
        const nextY = p.y + dy;

        if (nextX > 0 && nextX < canvas.width - p.w) p.x = nextX;
        if (nextY > 0 && nextY < canvas.height - p.h) p.y = nextY;

        // –õ–æ–≥–∏–∫–∞ –ø–æ–±–µ–≥–∞ —Å–∏—Å—Ç–µ–º–Ω–∏–∫–∞ –ø—Ä–∏ 100% —Ö–∞–æ—Å–∞
        if (state.chaos >= 100) {
            const pc = state.objects.find(o => o.id === 'pc');
            const dist = Math.hypot((p.x + p.w/2) - (pc.x + pc.w/2), (p.y + p.h/2) - (pc.y + pc.h/2));
            
            if (dist < 150) {
                // –í–µ–∫—Ç–æ—Ä –æ—Ç –∏–≥—Ä–æ–∫–∞ –∫ —Å–∏—Å—Ç–µ–º–Ω–∏–∫—É
                let vX = pc.x - p.x;
                let vY = pc.y - p.y;
                const mag = Math.sqrt(vX*vX + vY*vY);
                vX /= mag;
                vY /= mag;

                // –°–∫–æ—Ä–æ—Å—Ç—å –ø–æ–±–µ–≥–∞
                let moveX = vX * pc.fleeSpeed;
                let moveY = vY * pc.fleeSpeed;

                // --- –õ–û–ì–ò–ö–ê –í–´–¢–ï–°–ù–ï–ù–ò–Ø –ò–ó –£–ì–õ–û–í ---
                // –ï—Å–ª–∏ –º—ã —Å–ª–∏—à–∫–æ–º –±–ª–∏–∑–∫–æ –∫ –∫—Ä–∞—è–º, –¥–æ–±–∞–≤–ª—è–µ–º "—Å–∏–ª—É", —Ç–æ–ª–∫–∞—é—â—É—é –∫ —Ü–µ–Ω—Ç—Ä—É
                const margin = 60;
                const centerPush = 3; // –°–∏–ª–∞ –≤—ã—Ç–∞–ª–∫–∏–≤–∞–Ω–∏—è –∫ —Ü–µ–Ω—Ç—Ä—É

                if (pc.x < margin) moveX += centerPush;
                if (pc.x > canvas.width - pc.w - margin) moveX -= centerPush;
                if (pc.y < margin) moveY += centerPush;
                if (pc.y > canvas.height - pc.h - margin) moveY -= centerPush;

                pc.x += moveX;
                pc.y += moveY;

                // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≥—Ä–∞–Ω–∏—Ü–∞–º–∏ —ç–∫—Ä–∞–Ω–∞
                pc.x = Math.max(0, Math.min(canvas.width - pc.w, pc.x));
                pc.y = Math.max(0, Math.min(canvas.height - pc.h, pc.y));
                pc.name = "BTM@37*(431) –í –ü–ê–ù–ò–ö–ï!";
            }
        }

        state.nearObject = null;
        state.objects.forEach(obj => {
            const dist = Math.hypot((p.x + p.w/2) - (obj.x + obj.w/2), (p.y + p.h/2) - (obj.y + obj.h/2));
            if (dist < 70) state.nearObject = obj;
        });

        prompt.style.display = state.nearObject ? 'block' : 'none';
    }

    function interact(obj) {
        if (!obj) return;
        if (obj.type === 'pc') {
            if (state.chaos >= 100) {
                showDialog("–§–∏–ª–∏–ø–ø: '–≠–π! –ö—É–¥–∞ —Ç—ã?! –í–µ—Ä–Ω–∏—Å—å, –∂–µ–ª–µ–∑–∫–∞ —á–µ—Ä—Ç–æ–≤–∞! –ú–Ω–µ –Ω—É–∂–Ω–æ –≤—ã–∫–ª—é—á–∏—Ç—å —ç—Ç–æ—Ç –º–∞–π–Ω–∏–Ω–≥!'");
            } else {
                enterOS();
            }
        } else if (obj.type === 'npc') {
            if (state.chaos >= 100) {
                showDialog("–î—è–¥—è –í–∞—Å—è: '–§–∏–ª–∏–ø–ø, —Ç–≤–æ–π –∫–æ–º–ø—å—é—Ç–µ—Ä —Ç–æ–ª—å–∫–æ —á—Ç–æ —É–∫—É—Å–∏–ª –º–µ–Ω—è –∑–∞ –±–æ—Ç–∏–Ω–æ–∫ –∏ —É–±–µ–∂–∞–ª –≤ —Å—Ç–æ—Ä–æ–Ω—É —Ä—è–¥–æ–≤ —Å –¥–∏—Å–∫–µ—Ç–∞–º–∏! –≠–¢–û –ö–û–ù–ï–¶!'");
            } else if (state.chaos > 0) {
                showDialog("–î—è–¥—è –í–∞—Å—è: '–§-—Ñ-—Ñ–∏–ª–∏–ø–ø... –ø–æ—á–µ–º—É –º–µ–Ω—è —Ç-—Ç-—Ç—Ä—è—Å–µ—Ç? –ò –ø–æ—á–µ–º—É –≤ –Ω–µ–±–µ –ø-–ø-–ø–ª—ã–≤—É—Ç –æ–≥—Ä–æ–º–Ω—ã–µ –∫—É—Ä—Å–æ—Ä—ã?!'");
            } else {
                showDialog("–î—è–¥—è –í–∞—Å—è: '–°–ª—ã—à—å, –§–∏–ª–∏–ø–ø, –Ω–µ —Ç—Ä–æ–≥–∞–π —ç—Ç–æ—Ç –∫–æ–º–ø. –û–Ω –≥—É–¥–∏—Ç –∫–∞–∫ –ø—Ä–æ–∫–ª—è—Ç—ã–π. –®–∫–æ–ª—å–Ω–∏–∫–∏ —Å–∫–∞–∑–∞–ª–∏, —ç—Ç–æ –¥–ª—è –º–∞–π–Ω–∏–Ω–≥–∞ –∫–∞–∫–∏—Ö-—Ç–æ –º–æ–Ω–µ—Ç, –Ω–æ –ø–æ-–º–æ–µ–º—É –æ–Ω –º–∞–π–Ω–∏—Ç —Å–∞–º–æ –∑–ª–æ.'");
            }
        } else {
            showDialog("–§–∏–ª–∏–ø–ø: '–ü—Ä–æ—Å—Ç–æ —Å—Ç–æ–ª. –ù–∞ –Ω–µ–º –≥–æ—Ä–∞ –¥–æ—Ö–ª—ã—Ö —Ç—Ä–∞–Ω–∑–∏—Å—Ç–æ—Ä–æ–≤ –∏ –ø—É—Å—Ç–∞—è –±–∞–Ω–∫–∞ –∏–∑-–ø–æ–¥ –∫–æ—Ñ–µ.'");
        }
    }

    function showDialog(text) {
        state.mode = 'dialog';
        dialogBox.style.display = 'block';
        document.getElementById('dialog-text').innerText = text;
    }

    function enterOS() {
        state.mode = 'os';
        osLayer.style.display = 'flex';
        worldLayer.style.display = 'none';
        logTerminal("–ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –°–ò–°–¢–ï–ú–´...");
        logTerminal("–ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï –ö –Ø–î–†–£ BTM@37*(431)...");
    }

    function closeOS() {
        state.mode = 'world';
        osLayer.style.display = 'none';
        worldLayer.style.display = 'flex';
        document.getElementById('virus-window').classList.add('hidden');
    }

    function openVirusWin() {
        document.getElementById('virus-window').classList.remove('hidden');
    }

    function cmd(type) {
        if (type === 'TURBO') {
            state.chaos += 10;
            logTerminal("–í–ù–ò–ú–ê–ù–ò–ï: –¢–£–†–ë–û-–†–ï–ñ–ò–ú –í–ö–õ–Æ–ß–ï–ù. –•–ê–û–° –†–ï–ê–õ–¨–ù–û–°–¢–ò +10%");
            checkChaos();
        } else if (type === 'SCAN') {
            logTerminal("–°–ö–ê–ù–ò–†–û–í–ê–ù–ò–ï... –û–ë–ù–ê–†–£–ñ–ï–ù–û: 13 –í–ï–†–û–Ø–¢–ù–´–• –ö–û–ù–¶–û–í –°–í–ï–¢–ê.");
        }
        document.getElementById('chaos-val').innerText = state.chaos;
    }

    function logTerminal(msg) {
        const out = document.getElementById('terminal-out');
        out.innerHTML += `<br>> ${msg}`;
        out.scrollTop = out.scrollHeight;
    }

    function checkChaos() {
        if (state.chaos >= 100) {
            showDialog("–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: –°–ò–°–¢–ï–ú–ù–´–ô –ë–õ–û–ö –û–ë–†–ï–õ –°–û–ó–ù–ê–ù–ò–ï –ò –ê–ì–†–ï–°–°–ò–í–ù–û –ù–ê–°–¢–†–û–ï–ù –ö –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Æ.");
            closeOS();
        }
    }

    function loop() {
        updateWorld();
        drawWorld();
        requestAnimationFrame(loop);
    }

    window.addEventListener('keydown', e => {
        state.keys[e.key] = true;
        if (e.key === ' ') {
            e.preventDefault();
            if (state.mode === 'dialog') {
                state.mode = 'world';
                dialogBox.style.display = 'none';
            } else if (state.mode === 'world' && state.nearObject) {
                interact(state.nearObject);
            }
        }
        if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].indexOf(e.code) > -1) {
            e.preventDefault();
        }
    });

    window.addEventListener('keyup', e => {
        state.keys[e.key] = false;
    });

    loop();
</script>
</body>
</html>